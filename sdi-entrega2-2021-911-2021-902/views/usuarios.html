{% extends "base.html" %}

{% block titulo %} Wallapop {% endblock %}

{% block contenido_principal %}

<h2>Usuarios</h2>
<div class="row">
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>Nombre</th>
                <th>Apellidos</th>
                <th>Email</th>
                <th class="col-md-1"></th>
            </tr>
            </thead>
            <tbody>
            {% for usuario in param %}
            {% if usuario.rol !==0 %}
            <tr>
                <td>{{ usuario.nombre }}</td>
                <td>{{ usuario.apellidos }}</td>
                <td>{{ usuario.email }}</td>
                <td>
                    <input type="checkbox" onchange="manageList('{{ usuario._id.toString() }}')"/>
                </td>
            </tr>
            {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<button onclick="removeChecked()" class="btn btn-primary">Eliminar</button>

<script>

    var eliminados = [];

    function manageList(user) {
        console.log(user)
        if (eliminados.includes(user)) {
            var i = eliminados.indexOf(user);
            eliminados.splice(i, 1);
        } else {
            eliminados.push(user);
            console.log(eliminados)
        }
    }

    function removeChecked() {
        for (let user of eliminados) {
            console.log(user);
            $.get("/usuario/eliminar/" + user);
        }
        eliminados.splice(0, eliminados.length)
        location.reload();
    }

</script>

{% endblock %}